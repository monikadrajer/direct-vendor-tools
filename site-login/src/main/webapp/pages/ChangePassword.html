<script type="text/javascript">
	var accountRegister = new AccountRegister();

	$(document).ready(function() {
		
		$('.alert .close').click(function() {
			 $(this).closest('.alert').hide();
		});
		
		$('#fieldsRequireID').show();
		$('#changePwdForm').show();
		
		
		$("#changePwdForm").parsley({
	        successClass: "has-success",
	        errorClass: "alert alert-danger",
	        classHandler: function (el) {
	        	return el.$element.closest("div").children(".infoArea");
	        },
			errorsContainer: function (el) {
				return el.$element.closest("div").children(".infoArea");
			},
			errorsWrapper: '<ul></ul>',
			errorElem: '<li></li>'
		});
		
		if(sessionStorage.userLoggedIn == 1 || sessionStorage.passwordExpiryDays > 30){
			$("#currPwdLabelId").text("Current Password");
			if(sessionStorage.passwordExpiryDays > 30)
			{
				$('#pwdExpireAlert').show();
			}else
				$('#pwdExpireAlert').hide();
		}else
		{
			$("#currPwdLabelId").text("Temporary Password");
		}
		
		$("#changePwdBtn").click(function(e) {
			if($("#changePwdForm").parsley().validate()){
				$('#currPwdAlert').hide();
				accountRegister.validatePassword();
			}
		});
	});

</script>

<div class="modal-dialog">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
				aria-hidden="true">&times;</button>
			<h2 class="modal-title">Change Password</h2>
		</div>
		<div class="modal-body">

			<div class="alert alert-success alert-dismissible" role="alert"
				id="pwdExpireAlert" style="padding: 11px;" hidden="true">
				<button type="button" class="close"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				Your password is expired. please change the password.
			</div>
			
			<div class="alert alert-danger alert-dismissible" role="alert"
				id="currPwdAlert" style="padding: 11px;" hidden="true">
				<button type="button" class="close"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				Current password is not correct.
			</div>
			
			<div class="alert alert-success alert-dismissible" role="alert"
				id="changePwdAlert" style="padding: 11px;" hidden="true">
				
				Password changed Successfully.
			</div>
			
			<div id="chgPwdReqID" style="padding-bottom: 15px;">
				<h3 style="text-align: center">* All fields are required</h3>
			</div>
			
			<form id="changePwdForm" class="form-horizontal">
				<div class="form-group">
					<label class="col-lg-3 control-label" for="currentPassword" id="currPwdLabelId"></label>
					<div class="col-lg-9">
						<input type="password" data-parsley-required  
							class="form-control"
							name="currentPassword" id="currentPassword" />
						<div class="infoArea"></div>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-3 control-label" for="newPwd">New Password</label>
					<div class="col-lg-9">
						<input type="password" data-parsley-required data-parsley-minlength="8" data-parsley-maxlength="30" 
							data-parsley-pwdpattern
							data-parsley-pwdnotequal="#currentPassword"
							class="form-control"
							name="newPwd" id="newPwd" />
						<div class="infoArea"></div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-lg-3 control-label" for="cnfPwd">Confirm New Password</label>
					<div class="col-lg-9">
						<input type="password"
							class="form-control" data-parsley-required data-parsley-minlength="8" data-parsley-maxlength="30"
							data-parsley-error-message = "Confirm New password and New password fields should match."
							data-parsley-equalto="#newPwd"
							name="cnfPwd" id="cnfPwd" />
						<div class="infoArea"></div>
					</div>
				</div>

				<div class="form-group">
					<div class="col-lg-9 col-lg-offset-3">
						<button onclick="return false;" id="changePwdBtn"
							class="btn btn-primary">Change Password</button>
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer" style="margin-top: 0px;">
			<button type="button"  class="btn btn-default"
				data-dismiss="modal">Close</button>
		</div>
	</div>
</div>